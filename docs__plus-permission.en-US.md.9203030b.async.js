"use strict";(self.webpackChunkmetis_ui=self.webpackChunkmetis_ui||[]).push([[5552],{36750:function(o,t,s){s.r(t);var r=s(37496),c=s(82857),l=s(91238),m=s(83120),p=s(48415),x=s(95300),h=s(11024),I=s(65110),f=s(10006),v=s(18637),j=s(741),b=s(30166),i=s(91512),a=s(35055),_=s(30158),d=s(39546),n=s(80935),e=s(74132);function u(){return(0,e.jsx)(a.DumiPage,{children:(0,e.jsx)(d.Suspense,{fallback:(0,e.jsx)(_.Z,{}),children:(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"markdown",children:[(0,e.jsx)("p",{children:n.texts[0].value}),(0,e.jsxs)("h2",{id:"system-architecture",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#system-architecture",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"System Architecture"]}),(0,e.jsxs)("p",{children:[n.texts[1].value,(0,e.jsx)("strong",{children:n.texts[2].value}),n.texts[3].value]}),(0,e.jsxs)("ul",{children:[(0,e.jsxs)("li",{children:[(0,e.jsx)("strong",{children:n.texts[4].value}),n.texts[5].value]}),(0,e.jsxs)("li",{children:[(0,e.jsx)("strong",{children:n.texts[6].value}),n.texts[7].value]}),(0,e.jsxs)("li",{children:[(0,e.jsx)("strong",{children:n.texts[8].value}),n.texts[9].value]}),(0,e.jsxs)("li",{children:[(0,e.jsx)("strong",{children:n.texts[10].value}),n.texts[11].value]})]}),(0,e.jsxs)("h2",{id:"permission-data-structure",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#permission-data-structure",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Permission Data Structure"]}),(0,e.jsxs)("h3",{id:"user-permission-format",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#user-permission-format",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"User Permission Format"]}),(0,e.jsx)(i.Z,{lang:"typescript",children:n.texts[12].value}),(0,e.jsxs)("h3",{id:"permission-check-format",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#permission-check-format",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Permission Check Format"]}),(0,e.jsx)(i.Z,{lang:"typescript",children:n.texts[13].value}),(0,e.jsxs)("h2",{id:"permission-configuration",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#permission-configuration",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Permission Configuration"]}),(0,e.jsxs)("h3",{id:"1-user-permission-configuration",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#1-user-permission-configuration",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"1. User Permission Configuration"]}),(0,e.jsx)("p",{children:n.texts[14].value}),(0,e.jsxs)("p",{children:[n.texts[15].value,(0,e.jsx)("code",{children:n.texts[16].value}),n.texts[17].value]}),(0,e.jsx)(i.Z,{title:"src/mocks/handlers/user.ts",lang:"ts",children:n.texts[18].value}),(0,e.jsxs)("h3",{id:"2-route-permission-configuration",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#2-route-permission-configuration",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"2. Route Permission Configuration"]}),(0,e.jsxs)("p",{children:[n.texts[19].value,(0,e.jsx)("code",{children:n.texts[20].value}),n.texts[21].value]}),(0,e.jsx)(i.Z,{title:"src/routes.tsx",lang:"tsx",children:n.texts[22].value}),(0,e.jsxs)("h2",{id:"permission-component",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#permission-component",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Permission Component"]}),(0,e.jsxs)("h3",{id:"access-permission-control-component",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#access-permission-control-component",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Access Permission Control Component"]}),(0,e.jsx)("p",{children:n.texts[23].value}),(0,e.jsx)(i.Z,{lang:"tsx",children:n.texts[24].value}),(0,e.jsxs)("h2",{id:"menu-permission-filtering",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#menu-permission-filtering",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Menu Permission Filtering"]}),(0,e.jsxs)("p",{children:[n.texts[25].value,(0,e.jsx)("code",{children:n.texts[26].value}),n.texts[27].value]}),(0,e.jsx)(i.Z,{title:"src/utils/menu.ts",lang:"ts",children:n.texts[28].value}),(0,e.jsxs)("h2",{id:"route-guards",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#route-guards",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Route Guards"]}),(0,e.jsxs)("p",{children:[n.texts[29].value,(0,e.jsx)("code",{children:n.texts[30].value}),n.texts[31].value,(0,e.jsx)("code",{children:n.texts[32].value}),n.texts[33].value]}),(0,e.jsx)(i.Z,{lang:"typescript",children:n.texts[34].value}),(0,e.jsx)("p",{children:n.texts[35].value}),(0,e.jsx)("blockquote",{children:(0,e.jsx)("p",{children:n.texts[36].value})})]})})})})}t.default=u},80935:function(o,t,s){s.r(t),s.d(t,{texts:function(){return r}});const r=[{value:"Permission control is a fundamental feature commonly found in enterprise backend scenarios. Metis Plus provides a comprehensive permission management solution, including user authentication, permission validation, menu filtering, route guards, and more.",paraId:0},{value:"The Metis Plus permission system is designed based on the ",paraId:1,tocIndex:0},{value:"RBAC (Role-Based Access Control)",paraId:1,tocIndex:0},{value:" model, which includes the following core concepts:",paraId:1,tocIndex:0},{value:"User",paraId:2,tocIndex:0},{value:": The system user",paraId:2,tocIndex:0},{value:"Permission",paraId:2,tocIndex:0},{value:": Specific operation permissions, consisting of resources and actions",paraId:2,tocIndex:0},{value:"Resource",paraId:2,tocIndex:0},{value:": Functional modules or data entities in the system",paraId:2,tocIndex:0},{value:"Action",paraId:2,tocIndex:0},{value:": Specific operations on resources, such as read, edit, delete, etc.",paraId:2,tocIndex:0},{value:`export type UserPermissions = {
  resource: string; // Resource name
  actions?: string[]; // List of allowed actions
}[];

// Example
const userPermissions: UserPermissions = [
  { resource: 'dashboard', actions: ['view'] },
  { resource: 'admin', actions: ['read', 'edit', 'delete'] },
  { resource: 'workplace' }, // No actions means all permissions for the resource
];
`,paraId:3,tocIndex:2},{value:`export type Permission =
  | Auth // Single permission
  | Permission[] // Array of permissions (AND relationship)
  | { and: Permission[] } // Explicit AND relationship
  | { or: Permission[] }; // OR relationship

export type Auth = { resource: Resource; actions?: string[] } | Resource; // Can use string or RegExp

type Resource = string | RegExp;
`,paraId:4,tocIndex:3},{value:"In real projects, user permissions are returned by the backend. Here, we use mock data for demonstration.",paraId:5,tocIndex:5},{value:"Configure permissions for different users in ",paraId:6,tocIndex:5},{value:"src/mocks/handlers/user.ts",paraId:6,tocIndex:5},{value:":",paraId:6,tocIndex:5},{value:`http.get('/api/currentUser', async ({ request }) => {
  const token = request.headers.get('authorization') || '';

  let permissions: UserPermissions = [];
  if (token === 'fake_token_admin') {
    permissions = [
      { resource: 'admin', actions: ['read', 'edit', 'delete'] },
      { resource: 'dashboard', actions: ['view'] },
      { resource: 'workplace' },
    ];
  } else if (token === 'fake_token_user') {
    permissions = [{ resource: 'dashboard', actions: ['view'] }, { resource: 'workplace' }];
  }

  return HttpResponse.json({
    success: true,
    data: { permissions /* other user info */ },
  });
});
`,paraId:7,tocIndex:5},{value:"Configure route permissions in ",paraId:8,tocIndex:6},{value:"src/routes.tsx",paraId:8,tocIndex:6},{value:":",paraId:8,tocIndex:6},{value:`const routes: Route[] = [
  {
    name: 'menu.workplace',
    icon: <Squares2X2Outline />,
    path: 'workplace',
    component: () => import('@/pages/workplace'),
  },
  {
    name: 'menu.admin',
    icon: <Cog6ToothOutline />,
    path: 'admin',
    component: () => import('@/pages/admin'),
    permission: { resource: 'admin', actions: ['read'] }, // Requires admin read permission
  },
];
`,paraId:9,tocIndex:6},{value:"Used for permission control within components:",paraId:10,tocIndex:8},{value:`import Access from '@/components/Access';

const MyComponent = () => {
  return (
    <div>
      {/* Basic usage */}
      <Access permission={{ resource: 'admin' }}>
        <Button>Admin Only Button</Button>
      </Access>

      {/* With fallback */}
      <Access
        permission={{ resource: 'admin', actions: ['edit'] }}
        fallback={<span>Insufficient Permission</span>}
      >
        <Button>Edit</Button>
      </Access>

      {/* Complex permission */}
      <Access
        permission={{
          or: [{ resource: 'admin' }, { resource: 'editor', actions: ['publish'] }],
        }}
      >
        <Button>Publish Article</Button>
      </Access>
    </div>
  );
};
`,paraId:11,tocIndex:8},{value:"The menu system automatically filters out inaccessible menu items based on user permissions. The filtering logic is implemented in ",paraId:12,tocIndex:9},{value:"src/utils/menu.ts",paraId:12,tocIndex:9},{value:":",paraId:12,tocIndex:9},{value:`export function formatter(
  { data, t, userPerms }: FormatterProps,
  parentPath = '/',
  ignoreFilter = false,
): MenuDataItem[] {
  return data
    .filter((item) => {
      // Hide menu filtering
      if (!ignoreFilter && item.hideInMenu) return false;
      // Permission filtering
      if (item.permission && !hasPermission(item.permission, userPerms)) return false;
      return true;
    })
    .flatMap((item) => {
      // Menu item processing logic
    });
}
`,paraId:13,tocIndex:9},{value:"Route-level permission control is implemented via the ",paraId:14,tocIndex:10},{value:"Access",paraId:14,tocIndex:10},{value:" component, which is automatically wrapped in ",paraId:14,tocIndex:10},{value:"src/routes.tsx",paraId:14,tocIndex:10},{value:":",paraId:14,tocIndex:10},{value:`// src/routes.tsx
function generateRouteObjects(routes: Route[]): RouteObject[] {
  return routes.map((route) => {
    const { component, children, permission, ...rest } = route;

    const routeObj: RouteObject = { ...rest };

    if (component) {
      const Component = lazy(component);
      routeObj.element = (
        <Suspense fallback={<Loading />}>
          <Component />
        </Suspense>
      );

      // Automatically add permission guard
      if (permission) {
        routeObj.element = (
          <Access permission={permission} fallback={<Err403 />}>
            {routeObj.element}
          </Access>
        );
      }
    }

    if (Array.isArray(children) && children.length > 0) {
      routeObj.children = generateRouteObjects(children);
    }

    return routeObj;
  });
}
`,paraId:15,tocIndex:10},{value:"With this permission control system, Metis Plus provides a complete, flexible, and easy-to-use permission management solution for enterprise backend applications, helping developers quickly build secure and reliable enterprise-grade apps.",paraId:16,tocIndex:10},{value:"Translate by ChartGPT",paraId:17,tocIndex:10}]}}]);
